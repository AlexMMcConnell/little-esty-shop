require 'rails_helper'
require './app/services/github_service'

RSpec.describe GithubService do
  it 'returns the contributions data' do
    mock_response = "[{\"login\":\"GregoryJFischer\",\"id\":67120586,\"node_id\":\"MDQ6VXNlcjY3MTIwNTg2\",\"avatar_url\":\"https://avatars.githubusercontent.com/u/67120586?v=4\",\"gravatar_id\":\"\",\"url\":\"https://api.github.com/users/GregoryJFischer\",\"html_url\":\"https://github.com/GregoryJFischer\",\"followers_url\":\"https://api.github.com/users/GregoryJFischer/followers\",\"following_url\":\"https://api.github.com/users/GregoryJFischer/following{/other_user}\",\"gists_url\":\"https://api.github.com/users/GregoryJFischer/gists{/gist_id}\",\"starred_url\":\"https://api.github.com/users/GregoryJFischer/starred{/owner}{/repo}\",\"subscriptions_url\":\"https://api.github.com/users/GregoryJFischer/subscriptions\",\"organizations_url\":\"https://api.github.com/users/GregoryJFischer/orgs\",\"repos_url\":\"https://api.github.com/users/GregoryJFischer/repos\",\"events_url\":\"https://api.github.com/users/GregoryJFischer/events{/privacy}\",\"received_events_url\":\"https://api.github.com/users/GregoryJFischer/received_events\",\"type\":\"User\",\"site_admin\":false,\"contributions\":55},{\"login\":\"BrianZanti\",\"id\":8962411,\"node_id\":\"MDQ6VXNlcjg5NjI0MTE=\",\"avatar_url\":\"https://avatars.githubusercontent.com/u/8962411?v=4\",\"gravatar_id\":\"\",\"url\":\"https://api.github.com/users/BrianZanti\",\"html_url\":\"https://github.com/BrianZanti\",\"followers_url\":\"https://api.github.com/users/BrianZanti/followers\",\"following_url\":\"https://api.github.com/users/BrianZanti/following{/other_user}\",\"gists_url\":\"https://api.github.com/users/BrianZanti/gists{/gist_id}\",\"starred_url\":\"https://api.github.com/users/BrianZanti/starred{/owner}{/repo}\",\"subscriptions_url\":\"https://api.github.com/users/BrianZanti/subscriptions\",\"organizations_url\":\"https://api.github.com/users/BrianZanti/orgs\",\"repos_url\":\"https://api.github.com/users/BrianZanti/repos\",\"events_url\":\"https://api.github.com/users/BrianZanti/events{/privacy}\",\"received_events_url\":\"https://api.github.com/users/BrianZanti/received_events\",\"type\":\"User\",\"site_admin\":false,\"contributions\":51},{\"login\":\"yosoynatebrown\",\"id\":77140183,\"node_id\":\"MDQ6VXNlcjc3MTQwMTgz\",\"avatar_url\":\"https://avatars.githubusercontent.com/u/77140183?v=4\",\"gravatar_id\":\"\",\"url\":\"https://api.github.com/users/yosoynatebrown\",\"html_url\":\"https://github.com/yosoynatebrown\",\"followers_url\":\"https://api.github.com/users/yosoynatebrown/followers\",\"following_url\":\"https://api.github.com/users/yosoynatebrown/following{/other_user}\",\"gists_url\":\"https://api.github.com/users/yosoynatebrown/gists{/gist_id}\",\"starred_url\":\"https://api.github.com/users/yosoynatebrown/starred{/owner}{/repo}\",\"subscriptions_url\":\"https://api.github.com/users/yosoynatebrown/subscriptions\",\"organizations_url\":\"https://api.github.com/users/yosoynatebrown/orgs\",\"repos_url\":\"https://api.github.com/users/yosoynatebrown/repos\",\"events_url\":\"https://api.github.com/users/yosoynatebrown/events{/privacy}\",\"received_events_url\":\"https://api.github.com/users/yosoynatebrown/received_events\",\"type\":\"User\",\"site_admin\":false,\"contributions\":50},{\"login\":\"AlexMMcConnell\",\"id\":84515713,\"node_id\":\"MDQ6VXNlcjg0NTE1NzEz\",\"avatar_url\":\"https://avatars.githubusercontent.com/u/84515713?v=4\",\"gravatar_id\":\"\",\"url\":\"https://api.github.com/users/AlexMMcConnell\",\"html_url\":\"https://github.com/AlexMMcConnell\",\"followers_url\":\"https://api.github.com/users/AlexMMcConnell/followers\",\"following_url\":\"https://api.github.com/users/AlexMMcConnell/following{/other_user}\",\"gists_url\":\"https://api.github.com/users/AlexMMcConnell/gists{/gist_id}\",\"starred_url\":\"https://api.github.com/users/AlexMMcConnell/starred{/owner}{/repo}\",\"subscriptions_url\":\"https://api.github.com/users/AlexMMcConnell/subscriptions\",\"organizations_url\":\"https://api.github.com/users/AlexMMcConnell/orgs\",\"repos_url\":\"https://api.github.com/users/AlexMMcConnell/repos\",\"events_url\":\"https://api.github.com/users/AlexMMcConnell/events{/privacy}\",\"received_events_url\":\"https://api.github.com/users/AlexMMcConnell/received_events\",\"type\":\"User\",\"site_admin\":false,\"contributions\":35},{\"login\":\"PhiMed\",\"id\":87627363,\"node_id\":\"MDQ6VXNlcjg3NjI3MzYz\",\"avatar_url\":\"https://avatars.githubusercontent.com/u/87627363?v=4\",\"gravatar_id\":\"\",\"url\":\"https://api.github.com/users/PhiMed\",\"html_url\":\"https://github.com/PhiMed\",\"followers_url\":\"https://api.github.com/users/PhiMed/followers\",\"following_url\":\"https://api.github.com/users/PhiMed/following{/other_user}\",\"gists_url\":\"https://api.github.com/users/PhiMed/gists{/gist_id}\",\"starred_url\":\"https://api.github.com/users/PhiMed/starred{/owner}{/repo}\",\"subscriptions_url\":\"https://api.github.com/users/PhiMed/subscriptions\",\"organizations_url\":\"https://api.github.com/users/PhiMed/orgs\",\"repos_url\":\"https://api.github.com/users/PhiMed/repos\",\"events_url\":\"https://api.github.com/users/PhiMed/events{/privacy}\",\"received_events_url\":\"https://api.github.com/users/PhiMed/received_events\",\"type\":\"User\",\"site_admin\":false,\"contributions\":27},{\"login\":\"timomitchel\",\"id\":23040094,\"node_id\":\"MDQ6VXNlcjIzMDQwMDk0\",\"avatar_url\":\"https://avatars.githubusercontent.com/u/23040094?v=4\",\"gravatar_id\":\"\",\"url\":\"https://api.github.com/users/timomitchel\",\"html_url\":\"https://github.com/timomitchel\",\"followers_url\":\"https://api.github.com/users/timomitchel/followers\",\"following_url\":\"https://api.github.com/users/timomitchel/following{/other_user}\",\"gists_url\":\"https://api.github.com/users/timomitchel/gists{/gist_id}\",\"starred_url\":\"https://api.github.com/users/timomitchel/starred{/owner}{/repo}\",\"subscriptions_url\":\"https://api.github.com/users/timomitchel/subscriptions\",\"organizations_url\":\"https://api.github.com/users/timomitchel/orgs\",\"repos_url\":\"https://api.github.com/users/timomitchel/repos\",\"events_url\":\"https://api.github.com/users/timomitchel/events{/privacy}\",\"received_events_url\":\"https://api.github.com/users/timomitchel/received_events\",\"type\":\"User\",\"site_admin\":false,\"contributions\":9},{\"login\":\"scottalexandra\",\"id\":8812335,\"node_id\":\"MDQ6VXNlcjg4MTIzMzU=\",\"avatar_url\":\"https://avatars.githubusercontent.com/u/8812335?v=4\",\"gravatar_id\":\"\",\"url\":\"https://api.github.com/users/scottalexandra\",\"html_url\":\"https://github.com/scottalexandra\",\"followers_url\":\"https://api.github.com/users/scottalexandra/followers\",\"following_url\":\"https://api.github.com/users/scottalexandra/following{/other_user}\",\"gists_url\":\"https://api.github.com/users/scottalexandra/gists{/gist_id}\",\"starred_url\":\"https://api.github.com/users/scottalexandra/starred{/owner}{/repo}\",\"subscriptions_url\":\"https://api.github.com/users/scottalexandra/subscriptions\",\"organizations_url\":\"https://api.github.com/users/scottalexandra/orgs\",\"repos_url\":\"https://api.github.com/users/scottalexandra/repos\",\"events_url\":\"https://api.github.com/users/scottalexandra/events{/privacy}\",\"received_events_url\":\"https://api.github.com/users/scottalexandra/received_events\",\"type\":\"User\",\"site_admin\":false,\"contributions\":3},{\"login\":\"jamisonordway\",\"id\":33180544,\"node_id\":\"MDQ6VXNlcjMzMTgwNTQ0\",\"avatar_url\":\"https://avatars.githubusercontent.com/u/33180544?v=4\",\"gravatar_id\":\"\",\"url\":\"https://api.github.com/users/jamisonordway\",\"html_url\":\"https://github.com/jamisonordway\",\"followers_url\":\"https://api.github.com/users/jamisonordway/followers\",\"following_url\":\"https://api.github.com/users/jamisonordway/following{/other_user}\",\"gists_url\":\"https://api.github.com/users/jamisonordway/gists{/gist_id}\",\"starred_url\":\"https://api.github.com/users/jamisonordway/starred{/owner}{/repo}\",\"subscriptions_url\":\"https://api.github.com/users/jamisonordway/subscriptions\",\"organizations_url\":\"https://api.github.com/users/jamisonordway/orgs\",\"repos_url\":\"https://api.github.com/users/jamisonordway/repos\",\"events_url\":\"https://api.github.com/users/jamisonordway/events{/privacy}\",\"received_events_url\":\"https://api.github.com/users/jamisonordway/received_events\",\"type\":\"User\",\"site_admin\":false,\"contributions\":1}]"

    allow_any_instance_of(Faraday::Connection).to receive(:get).and_return(Faraday::Response.new)
    allow_any_instance_of(Faraday::Response).to receive(:body).and_return(mock_response)

    json = GithubService.contributors

    expect(json).to be_a(Hash)
    expect(json).to have_key("GregoryJFischer")
    expect(json["GregoryJFischer"]).to eq 55
  end
end
